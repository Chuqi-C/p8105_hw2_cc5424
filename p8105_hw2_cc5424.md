p8105_hw2_cc5424
================
ChuqiChen
2025-09-24

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(readxl)
library(haven)
```

problem1

``` r
pols_df = read_csv("./data1/pols-month.csv", 
                   na = c("NA","O",".") 
                   ) |>
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), sep = "-", convert = TRUE) |>
  mutate(
    month_name = month.name[as.integer(month)], 
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem",
    )
  ) |>
  select(-prez_gop, -prez_dem, -day) |>
  arrange(year, match(month, month.name)) |>
  relocate(year, month_name) 
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

The dataset has 822 rows and 10 columns. Arrange according to year is
from 1947 to 2015. There are variables including year, month_name,
month, gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem, president.

``` r
snp_df = 
  read_csv("./data1/snp.csv", 
           na = c("NA","O",".") 
           ) |> 
  janitor::clean_names() |> 
  separate(date, into = c("month", "day", "year"), sep = "/", convert = TRUE) |> 
  mutate(
    year1 = case_when(
      year >= 50 ~ year + 1900,
      year < 50 ~ year + 2000
      )
    ) |>
  mutate( 
    year = year1, 
    month_name = month.name[month] 
    ) |>
  select(-year, -month, -day) |> 
  rename(year = year1, 
         month = month_name) |> 
  arrange(year, match(month, month.name)) |> 
  relocate(year, month)
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

The dataset has 787 rows and 3 columns. Arrange according to year is
from 1950 to 2015. There are variables including year, month, close.

``` r
pols_df = read_csv("./data1/pols-month.csv", 
                   na = c("NA","O",".") 
                   ) |>
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), sep = "-", convert = TRUE) |>
  mutate(
    month_name = month.name[as.integer(month)], 
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem",
    )
  ) |>
  select(-prez_gop, -prez_dem, -day) |>
  mutate(
    date = sprintf("%d-%02d", year, month)
  ) |>
  arrange(date) |>
  relocate(date) 
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
unemployment_df = 
  read_csv("./data1/unemployment.csv",  
                   na = c("NA","O",".") 
                   ) |> 
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) |>
  mutate(month_name = month.name[match(month, month.abb)]) |>
  rename(year = Year) |>
  mutate(
    date = sprintf("%d-%02d", year, match(month, month.abb))
  )
```

    ## Warning: One or more parsing issues, call `problems()` on your data frame for details,
    ## e.g.:
    ##   dat <- vroom(...)
    ##   problems(dat)

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
pols_unemp_df = 
  left_join(pols_df, unemployment_df, by = "date") |>
  arrange(date)
```

The dataset has 822 rows and 15 columns. Arrange according to year is
from 1947 to 2015. There are variables including date, year.x, month.x,
gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem, month_name.x,
president, year.y, month.y, unemployment, month_name.y.

problem2

``` r
mr_df = 
  read_excel(
    "./data2/202509 Trash Wheel Collection Data.xlsx", 
    sheet = "Mr. Trash Wheel", 
    range = "A2:N709", 
    na = c("NA","O",".") 
    ) |>
  janitor::clean_names() |>
  select(-dumpster) |>
  mutate(
    sports_balls = as.integer(round(sports_balls)), 
    year = as.integer(year), 
    wheel = "Mr. Trash Wheel"
    )
  
professor_df = 
  read_excel(
    "./data2/202509 Trash Wheel Collection Data.xlsx", 
    sheet = "Professor Trash Wheel", 
    range = "A2:M134", 
    na = c("NA","O",".") 
    ) |>
  janitor::clean_names() |>
  select(-dumpster) |>
  mutate(
    sports_balls = NA, 
    year = as.integer(year), 
    wheel = "Professor Trash Wheel"
  )

gwynns_falls_df = 
  read_excel(
    "./data2/202509 Trash Wheel Collection Data.xlsx", 
    sheet = "Gwynns Falls Trash Wheel", 
    range = "A2:L351", 
    na = c("NA","O",".") 
    ) |>
  janitor::clean_names() |>
  select(-dumpster) |>
  mutate(
    sports_balls = NA, 
    year = as.integer(year), 
    wheel = "Gwynns Falls Trash Wheel"
  )

trash_data = bind_rows(mr_df, professor_df, gwynns_falls_df)

glimpse(trash_data)
```

    ## Rows: 1,188
    ## Columns: 14
    ## $ month              <chr> "May", "May", "May", "May", "May", "May", "May", "M…
    ## $ year               <int> 2014, 2014, 2014, 2014, 2014, 2014, 2014, 2014, 201…
    ## $ date               <dttm> 2014-05-16, 2014-05-16, 2014-05-16, 2014-05-17, 20…
    ## $ weight_tons        <dbl> 4.31, 2.74, 3.45, 3.10, 4.06, 2.71, 1.91, 3.70, 2.5…
    ## $ volume_cubic_yards <dbl> 18, 13, 15, 15, 18, 13, 8, 16, 14, 18, 15, 19, 15, …
    ## $ plastic_bottles    <dbl> 1450, 1120, 2450, 2380, 980, 1430, 910, 3580, 2400,…
    ## $ polystyrene        <dbl> 1820, 1030, 3100, 2730, 870, 2140, 1090, 4310, 2790…
    ## $ cigarette_butts    <dbl> 126000, 91000, 105000, 100000, 120000, 90000, 56000…
    ## $ glass_bottles      <dbl> 72, 42, 50, 52, 72, 46, 32, 58, 49, 75, 38, 45, 58,…
    ## $ plastic_bags       <dbl> 584, 496, 1080, 896, 368, 672, 416, 1552, 984, 448,…
    ## $ wrappers           <dbl> 1162, 874, 2032, 1971, 753, 1144, 692, 3015, 1988, …
    ## $ sports_balls       <int> 7, 5, 6, 6, 7, 5, 3, 6, 6, 7, 6, 8, 6, 6, 6, 6, 5, …
    ## $ homes_powered      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
    ## $ wheel              <chr> "Mr. Trash Wheel", "Mr. Trash Wheel", "Mr. Trash Wh…

``` r
n_obs = nrow(trash_data)

prof_total_weight = trash_data |>
  filter(wheel == "Professor Trash Wheel") |>
  summarise(total_weight = sum(weight_tons, na.rm = TRUE)) |>
  pull(total_weight)
```

There are 1188 observations in the resulting dataset. There are
variables including month, year, date, weight_tons, volume_cubic_yards,
plastic_bottles, polystyrene, cigarette_butts, glass_bottles,
plastic_bags, wrappers, sports_balls, homes_powered, wheel. The total
weight of trash collected by Professor Trash Wheel is 282.26 tons. The
total number of cigarette butts collected by Gwynnda in June of 2022 is
18120.

problem 3

``` r
zori_df = 
  read_csv(
    "./data3/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", 
    na = c("NA","O",".") 
    ) |>
  janitor::clean_names() |>
  pivot_longer(
    x2015_01_31:x2024_08_31,
    names_to = "date",
    values_to = "prices"
  ) |>
  mutate(
    zip_code = as.character(region_name), 
    date = str_remove(date, "^x"), 
    date = str_replace_all(date, "_", "-"), 
    date = as.Date(date)
    ) |>
  select(-region_name, -region_type) |>
  relocate(zip_code)
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zipcodes_df = 
  read_csv(
    "./data3/Zip Codes.csv", 
    na = c("NA","O",".") 
    ) |>
  janitor::clean_names() |>
  mutate(
    zip_code = as.character(zip_code)
    ) |>
  relocate(zip_code)
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zori_zip_df = 
  left_join(zori_df, zipcodes_df, by = "zip_code") |>
  select(
    zip_code, city, county_name, neighborhood, 
    date, prices
  ) |>
  arrange(zip_code, date)
```

    ## Warning in left_join(zori_df, zipcodes_df, by = "zip_code"): Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 4757 of `x` matches multiple rows in `y`.
    ## ℹ Row 256 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

3.1

``` r
total_obs = nrow(zori_zip_df)

unique_zips = zori_zip_df |>
  distinct(zip_code) |>
  nrow()

unique_neighborhoods = zori_zip_df |>
  distinct(neighborhood) |>
  nrow()
```

There are 17516 observations exist. 149unique ZIP codes are included.
There are 43 unique neighborhoods.

3.2 ZIPs in zipcodes_df but not in zori_df

``` r
zips_only_in_zipcodes = setdiff(zipcodes_df$zip_code, zori_df$zip_code)
zips_only_in_zipcodes
```

    ##   [1] "10464" "10474" "10475" "10499" "10550" "10704" "10705" "10803" "11202"
    ##  [10] "11224" "11239" "11241" "11242" "11243" "11245" "11247" "11251" "11252"
    ##  [19] "11256" "10008" "10020" "10041" "10043" "10045" "10047" "10048" "10055"
    ##  [28] "10072" "10080" "10081" "10082" "10087" "10101" "10102" "10103" "10104"
    ##  [37] "10105" "10106" "10107" "10108" "10109" "10110" "10111" "10112" "10113"
    ##  [46] "10114" "10115" "10116" "10117" "10118" "10119" "10120" "10121" "10122"
    ##  [55] "10123" "10124" "10125" "10126" "10129" "10130" "10131" "10132" "10133"
    ##  [64] "10138" "10149" "10150" "10151" "10152" "10153" "10154" "10155" "10156"
    ##  [73] "10157" "10158" "10159" "10160" "10161" "10163" "10164" "10165" "10166"
    ##  [82] "10167" "10168" "10169" "10170" "10171" "10172" "10173" "10174" "10175"
    ##  [91] "10176" "10177" "10178" "10179" "10185" "10197" "10199" "10213" "10242"
    ## [100] "10249" "10256" "10259" "10260" "10261" "10265" "10268" "10269" "10270"
    ## [109] "10271" "10272" "10273" "10274" "10275" "10276" "10277" "10278" "10279"
    ## [118] "10281" "10285" "10286" "10292" "11001" "11004" "11005" "11040" "11096"
    ## [127] "11351" "11352" "11359" "11362" "11363" "11371" "11380" "11381" "11386"
    ## [136] "11405" "11411" "11412" "11413" "11414" "11416" "11417" "11419" "11420"
    ## [145] "11421" "11422" "11423" "11424" "11425" "11427" "11428" "11429" "11430"
    ## [154] "11431" "11433" "11436" "11439" "11451" "11499" "11559" "11580" "11690"
    ## [163] "11694" "11695" "11697" "10302" "10307" "10309" "10310" "10311" "10313"

These ZIP codes may be commercial, non-residential, or lack rental data
on Zillow. For example, ZIPs tied to industrial areas, airports, or
government facilities might be excluded.

3.3

``` r
jan_2020_2021 = zori_zip_df |>
  filter(date %in% as.Date(c("2020-01-31", "2021-01-31"))) |>
  select(zip_code, city, neighborhood, date, prices) |>
  pivot_wider(
    names_from = date, 
    values_from = prices, 
    names_prefix = "price_",
    values_fn = mean, 
    values_fill = NA
    ) |>
  mutate(
    `price_2020-01-31` = as.numeric(`price_2020-01-31`),
    `price_2021-01-31` = as.numeric(`price_2021-01-31`)
  ) |>
  drop_na(`price_2020-01-31`, `price_2021-01-31`) |>
  mutate(
    price_change = `price_2021-01-31` - `price_2020-01-31`,
    pct_change = price_change / `price_2020-01-31` * 100
  ) |>
  arrange(price_change) |>
  slice(1:10)

jan_2020_2021 |>
  select(zip_code, city, neighborhood, 
         `price_2020-01-31`, `price_2021-01-31`, price_change, pct_change) |>
  print()
```

    ## # A tibble: 10 × 7
    ##    zip_code city     neighborhood          `price_2020-01-31` `price_2021-01-31`
    ##    <chr>    <chr>    <chr>                              <dbl>              <dbl>
    ##  1 10007    New York Lower Manhattan                    6334.              5422.
    ##  2 10069    New York <NA>                               4623.              3875.
    ##  3 10009    New York Lower East Side                    3406.              2692.
    ##  4 10016    New York Gramercy Park and Mu…              3731.              3019.
    ##  5 10001    New York Chelsea and Clinton                4108.              3398.
    ##  6 10002    New York Lower East Side                    3645.              2935.
    ##  7 10004    New York Lower Manhattan                    3150.              2444.
    ##  8 10038    New York Lower Manhattan                    3573.              2876.
    ##  9 10012    New York Greenwich Village an…              3629.              2942.
    ## 10 10010    New York Gramercy Park and Mu…              3697.              3012.
    ## # ℹ 2 more variables: price_change <dbl>, pct_change <dbl>

These ZIP codes likely include Manhattan or central Brooklyn areas,
which saw sharp rent declines during COVID due to: People moving out of
the city Shift to remote work Drop in demand for dense urban rentals
